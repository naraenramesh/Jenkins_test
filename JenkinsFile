pipeline {
 agent any

environment{

             PATH="$HOME/.yarn/bin:$HOME/.config/yarn/global/node_modules/.bin:$PATH"
             EXPECTED_NODE_VERSION="20.11.0"
}
 stages{

  stage('Install Dependencies'){
    steps{
         sh '''
          if ! command -v yarn &> /dev/null
                    then
                        echo "Yarn not found. Installing Yarn..."
                        curl -o- -L https://yarnpkg.com/install.sh | bash
                    else
                        echo "Yarn is already installed"
                    fi

                    # Verify Yarn version
                    yarn --version

            echo "Yarn installed"
node_version=$(node --version)

# Check if the current Node.js version matches the expected version
if [ "$node_version" != "v$EXPECTED_NODE_VERSION" ]
then
            nvm install ${EXPECTED_NODE_VERSION}
            nvm use ${EXPECTED_NODE_VERSION}
echo "Node of version $(node --version) installed`
            fi

            sh 'yarn'
            echo "Node modules created"
              '''
  }
  }
  stage('Run Tests'){
    steps{
    sh "yarn test"
    echo "Test results"
    }
  }
 }
}
